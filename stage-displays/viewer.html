
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>GlassProv</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/viewercss.css" rel="stylesheet">
    <script src="//www.parsecdn.com/js/parse-1.2.19.min.js"></script>
    <script type="text/javascript" src="js/viewer.js"></script>
    <link href="videos/video-js/video-js.css" rel="stylesheet">

    <script src="videos/video-js/video.js"></script>
    <script type="text/javascript" src="js/msgpack.js"></script>
    <script type="text/javascript" src="js/wearscript-client.js"></script>
    <script type="text/javascript" src="js/reconnecting-websocket.js"></script>
    <script type="text/javascript" src="jquery/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="js/underscore.js"></script>

    <script type="text/javascript">
        var didRegister = false;
        Date.prototype.today = function () {
            return ((this.getDate() < 10)?"0":"") + this.getDate() +"/"+(((this.getMonth()+1) < 10)?"0":"") + (this.getMonth()+1) +"/"+ this.getFullYear();
        }

        Date.prototype.timeNow = function () {
             return ((this.getHours() < 10)?"0":"") + this.getHours() +":"+ ((this.getMinutes() < 10)?"0":"") + this.getMinutes() +":"+ ((this.getSeconds() < 10)?"0":"") + this.getSeconds();
        }

        function padInt(_int, len) {
          paddingNeeded = len - _int.toString().length;
          if (paddingNeeded < 0) {
            return _int;
          } else {
            paddingArr = [];
            for (var k = 0; k < paddingNeeded; k++) {
              paddingArr.push('0');
            }
            return paddingArr.join("") + _int.toString();
          }
        }

        function buildData(){
        var ans1 = $("#q1").val();
        var ans2 = $("#q2").val();
        var ans3 = $("#q3").val();
        var ans4 = $("#q4").val();
        var ans5 = $("#q5").val();
        var ans6 = $("#q6").val();
        var ans7 = $("#q7").val();
        var ans8 = $("#q8").val();
        var ans9 = $("#q9").val();
        var ans10 = $("#q10").val();
        var ans11 = $("#q11").val();
          Parse.initialize("Ksv3PFuEl6aMCIMzNdra8940xTo0J9sxxpSZJgp5", "dW2DZI6z6x1jw7zQh1ZjvPCR4KwauvuufuBMNcgl");

          var Answers = Parse.Object.extend("Answers");
          var answers = new Answers();
          console.log("WRITING DATA NOW");
          console.log(ans1);
          console.log(ans2);
          console.log(ans3);
          console.log(ans4);
          console.log(ans5);
          console.log(ans6);
          console.log(ans7);
          console.log(ans8);
          console.log(ans9);
          console.log(ans10);
          console.log(ans11);  

          answers.save({
  'ans1': ans1, 'ans2': ans2,'ans3': ans3,'ans4': ans4,'ans5': ans5,'ans6': ans6,'ans7': ans7,'ans8': ans8,'ans9': ans9,'ans10': ans10, 'ans11': ans11}, {
  success: function(answers) {
    console.log('The object was saved successfully.');
  },
  error: function(answers, error) {
    console.log('The save failed.');
  }
});        
        }

        function visibility_switch(id) {

      document.getElementById('question1').style.display = "none";
      document.getElementById('question2').style.display = "none";
      document.getElementById('question3').style.display = "none";
      document.getElementById('question4').style.display = "none";
      document.getElementById('question5').style.display = "none";
      document.getElementById('question6').style.display = "none";
      document.getElementById('question7').style.display = "none";
      document.getElementById('question8').style.display = "none";
      document.getElementById('question9').style.display = "none";      
      console.log('In ID');
      console.log(id);
    /* If the ID of box1 is passed, hide the IDs of the other boxes */
    if(id == 'question1') {
      document.getElementById('question1').style.display = "block";
      document.getElementById('questions').style.display = "none";   
    }
    
   /* If the ID of box2 is passed, hide the IDs of the other boxes */
    else if(id == 'question2') {
      document.getElementById('question2').style.display = "block";
      console.log('In Question 1 JUST TO SHOW I CAN PRINT');           
    }
    
     /* If the ID of box3 is passed, hide the IDs of the other boxes */
    else if(id == 'question3') {
      document.getElementById('question3').style.display = "block";           
    }

    else if(id == 'question4') {
      document.getElementById('question4').style.display = "block";           
    }

       /* If the ID of box2 is passed, hide the IDs of the other boxes */
    else if(id == 'question5') {
      document.getElementById('question5').style.display = "block";           
    }
    
     /* If the ID of box3 is passed, hide the IDs of the other boxes */
    else if(id == 'question6') {
      document.getElementById('question6').style.display = "block";           
    }

    else if(id == 'question7') {
      document.getElementById('question7').style.display = "block";           
    }

       /* If the ID of box2 is passed, hide the IDs of the other boxes */
    else if(id == 'question8') {
      document.getElementById('question8').style.display = "block";           
    }
    
     /* If the ID of box3 is passed, hide the IDs of the other boxes */
    else if(id == 'question9') {
      document.getElementById('question9').style.display = "block";           
    }
    
}

        Date.prototype.timeNowMilli = function () {
             return ((this.getHours() < 10)?"0":"") + this.getHours() +":"+ ((this.getMinutes() < 10)?"0":"") + this.getMinutes() +":"+ ((this.getSeconds() < 10)?"0":"") + this.getSeconds() + "." + padInt(this.getMilliseconds(), 3);
        }

        currentTimeString = function () {
            return new Date().today() + " @ " + new Date().timeNowMilli();
        }

        function registered(channel, name) {
            console.log("Registered as " + name);
        }


        var IDlist = [ "f8:8f:ca:25:58:6b", "f8:8f:ca:25:58:8b", "f8:8f:ca:25:c5:0b", "f8:8f:ca:24:64:89", "f8:8f:ca:24:65:25", "f8:8f:ca:25:f8:e5"];

        var nameList = ["all", "will", "russ", "lexie", "max", "paul"];

        var lineChannels = _.map(IDlist, function(el) {return "lines:" + el});
        lineChannels.unshift("lines");

        var vidChannels = _.map(IDlist, function(el){ return "videos:" + el});
        vidChannels.unshift("videos");

        wssuccess = function(data){
          server = data.wsurl;
          Socket = new ReconnectingWebSocket(server);
          // Socket = new WebSocket(server);
          console.log("Made the socket.");
          ws = myWearScriptConnectionFactory(Socket, function (connected) {
              console.log('Connected: ' + connected);
              ws.subscribe('registered', registered);
              if (!didRegister) {
                ws.send('register', 'registered', "dashboard:" + currentTimeString());
                didRegister = true;
              }
              ws.subscribe('blob', blob_cb);
          });

          // e.g. publish statement from broadcaster: 
          // ws.publish("glassprov", {user: "kevin.b.tu", glass:"1", command: "showline", line: "What's my line"});
          // ws.publish("glassprov", {user: "scottgwald", glass:"2", command: "playvideo", line: "vid001.mp4"});

          // User: username
          // glass: 1-4 (Which quadrant to display in)
          // command: "showline" or "playvideo"
          // line: text to display or video identifier

          //ws.subscribe('glassprov', glassprov_cb);
          // ws.subscribe('lines', lines_cb);

          // here we'll subscribe to "blob" instead

          //COMMENT CODE NOT REQUIRED
          //for (chan in lineChannels) {
          //  ws.subscribe(lineChannels[chan], lines_cb)
          //}
          //for (chan in vidChannels) {
          //  ws.subscribe(vidChannels[chan], vid_cb);
          //}
          //ws.subscribe("slides:", slides_cb);
      };
      // $.ajax({
      //     type: "GET",
      //     url: "/api/ws/get",
      //     dataType: 'json',
      //     success: wssuccess
      // });
      wssuccess({wsurl: "ws://localhost:8112/"});

      var nPanels = 1;

      function blob_cb(channel, actor, content) {
        var panel = nameList.indexOf(actor);
        if (panel == 0) {
          for (var i = 0; i < nPanels; i++ ) {
            $("#q" + (panel + 1) + " span").html(content);
          }
          //send to all
        } else {
          $("#q" + panel + " span").html(content);
          // send to the specific one
        }
      }

      function lines_cb(channel, message) {
          var panel = lineChannels.indexOf(channel);
          if (panel == 0) {
            for (var i = 0; i < nPanels; i++ ) {
              $("#q" + (panel + 1) + " span").html(message.text);
            }
            //send to all
          } else {
            $("#q" + panel + " span").html(message.text);
            // send to the specific one
          }
          // show line on panel
      }

      function slides_cb(channel, message) {
          console.log("slides");
          for (var i = 0; i < nPanels; i++ ) {
              $("#q" + (i + 1) + " span").html("<img style='max-height:100%;max-width:100%;' src='"+message.url+"'/>");
            }
      }
      // var id = 'video'+quadrant;
      //     var finalText = "<video loop autoplay preload id='"+id+"'"+" class='video-js vjs-default-skin'"+" preload='auto' width='500' height='280'"+"><source src="+"'"+"videos/"+message.line+"'"+" type='video/mp4' />"+"</video>";
      //     document.getElementsByClassName("text")[quadrant].innerHTML=finalText;

      function vid_cb(channel, message) {
          var panel = vidChannels.indexOf(channel);
          $("video").remove();
          if (panel == 0) {
            for (var i = 0; i < nPanels; i++ ) {
              $("#q" + (panel + 1) + " span").html("<video autoplay preload class='video-js vjs-default-skin' preload='auto'  style='max-height:100%;max-width:100%;'><source src='"+ escape(message.url)+"' type='video/mp4'/> </video>");
            }
            //send to all
          } else {
            $("#q" + panel + " span").html("<video autoplay preload class='video-js vjs-default-skin' preload='auto' style='max-height:100%;max-width:100%;'><source src='"+ escape(message.url)+"' type='video/mp4'/> </video>");
            // send to the specific one
          }
          // show line on panel
      }

            // WS.subscribe('lines:' + me, function(chan, data) {
            //     console.log("Got a lines object!");
            //     console.log(JSON.stringify(data));
            //     if (data.glassID == me) {
            //         WS.wake();
            //         WS.activityCreate();
            //         WS.displayCardTree();
            //         var tree = new WS.Cards();
            //         tree.add(data.text, 'GlassProv');
            //         WS.cardTree(tree);
            //         //console.log("It's me! And the text is: " + data.text);
            //         //WS.say(data.text);
            //     } else {
            //         console.log("It's not me. But the text is: " + data.text);
            //     }
            // });


      // function glassprov_cb(channel, message) {
      //   // update user name
      //   var quadrant = message.glass-1;
      //   document.getElementsByClassName("user")[quadrant].innerHTML=message.user;
      //   document.getElementsByClassName("audience-name")[quadrand].innerHTML="Submitted By: "+message.audience;
      //   if(message.command=="showline"){
      //     document.getElementsByClassName("text")[quadrant].innerHTML=message.line;
      //     $('text').textfill({ maxFontPixels: 75 });
      //   } else if(message.command=="playvideo"){
      //     var id = 'video'+quadrant;
      //     var finalText = "<video loop autoplay preload id='"+id+"'"+" class='video-js vjs-default-skin'"+" preload='auto' width='500' height='280'"+"><source src="+"'"+"videos/"+message.line+"'"+" type='video/mp4' />"+"</video>";
      //     document.getElementsByClassName("text")[quadrant].innerHTML=finalText;
      //   }
      // }

      function myWearScriptConnectionFactory(websocket, glassConnectedCallback) {
          function onopen(event) {
              console.log('opened');
        ws.subscribe('subscriptions', subscription_cb);
              ws.subscribe('log', log_cb);
              ws.subscribe('urlopen', urlopen_cb);
        subscription_cb();
          }
          var ws = new WearScriptConnection(websocket, "webapp", Math.floor(Math.random() * 100000), onopen);
          ws.subscribeTestHandler();
          function subscription_cb() {
        glassConnectedCallback(ws.exists('glass'));
              // TODO(brandyn): Only do this once, then provide a button to refresh
          }
          function log_cb(channel, message) {
              console.log(channel + ': ' + message);
              // TODO(brandyn): Have a notification that a log message was sent
          }
          function gist_modify_cb(channel, gists) {
              HACK_GIST_MODIFIED = gists;
              console.log('Gist modified');
          }
          function gist_get_cb(channel, gist) {
              window.HACK_GIST = gist;
              console.log(channel + ': ' + gist);
          }
          function urlopen_cb(channel, url) {
              window.open(url);
          }
          return ws;
      }
    </script>

    <font size="50" color="red">
    <!--<div >Elapsed Time: <span id="timeDisplay"></span></div>
    <a href="#" onclick="getCurrentTime();">Time</a> -->
  </font>

    <!--Mina's change-->

    <style type="text/css">
#questions {
border: 3px solid black;
display: block;
}

#question1 {
border: 3px solid blue;
display: none;
}
#question2 {
border: 3px solid green;
display: none;
}
#question3 {
border: 3px solid orange;
display: none;
}
#question4 {
border: 3px solid blue;
display: none;
}
#question5 {
border: 3px solid green;
display: none;
}
#question6 {
border: 3px solid orange;
display: none;
}
#question7 {
border: 3px solid blue;
display: none;
}
#question8 {
border: 3px solid green;
display: none;
}
#question9 {
border: 3px solid orange;
display: none;
}
</style>


<font size="3" color="red">
<a href="#" onclick="visibility_switch('question1');">Question 1</a> |
<a href="#" onclick="visibility_switch('question2');">Question 2</a> | 
<a href="#" onclick="visibility_switch('question3');">Question 3</a> | 
<a href="#" onclick="visibility_switch('question4');">Question 4</a> | 
<a href="#" onclick="visibility_switch('question5');">Question 5</a> | 
<a href="#" onclick="visibility_switch('question6');">Question 6</a> | 
<a href="#" onclick="visibility_switch('question7');">Question 7</a> | 
<a href="#" onclick="visibility_switch('question8');">Question 8</a> | 
<a href="#" onclick="visibility_switch('question9');">Question 9</a> |
<a href="#" onclick="buildData();">End</a>

<div id="questions">
<h1> Your questions will appear here :) </h1>
</div>

<div id="question1">
<form>
What color is Europe?<br> <input type="text" name="q1"  id="q1"><br>
What color is Africa (South of Sahara)? <br><input type="text" name="q2" id="q2">
</form>
</div>

<div id="question2">
<form>
  What countries were better off prior to 1800?<br> <input type="text" name="q3"  id="q3">
  </form>
</div>

<div id="question3">
<form>
  What were the two causes of the "catastrophe" in the early 20th century?<br> <input type="text" name="q4" id="q4">
  </form>
</div>

<div id="question4">
  <form>
  What year was Hans Rosling (the speaker) born? <br> <input type="text" name="q5" id="q5">
  </form>
</div>

<div id="question5">
  <form>
  What five "Asian giants" were still behind in 1948? <br> <input type="text" name="q6" id="q6">
  </form>
</div>

<div id="question6">
  <form>
  What was the best country in terms of health and wealth by 2009? <br> <input type="text" name="q7"  id="q7"><br>

  What was the worst country in terms of health and wealth by 2009? <br> <input type="text" name="q8"  id="q8">
  </form>
</div>

<div id="question7">
  <form>
  Which country is like the province of Guizhou? <br> <input type="text" name="q9"  id="q9">
  </form>
</div>

<div id="question8">
  <form>
  Which country is like the rural parts of Guizhou? <br> <input type="text" name="q10"  id="q10">
  </form>
</div>

<div id="question9">
  <form>
  How many numbers were plotted in this study? <br> <input type="text" name="q11" id="q11">
  </form>
</div>

    <video src="HansRosling.mp4" controls autoplay width="1024" height="768" id="video1"></video>
    
</font>

    <script>
    
    var oVideo = document.getElementById("video1"); 
    var display = document.getElementById("timeDisplay");
    var currentTime=oVideo.currentTime;
    var second_round=Math.floor(currentTime);
    var question1_time=75; 
    var question2_time=91;
    var question3_time=120;
    var question4_time=152;
    var question5_time=177;
    var question6_time=215;
    var question7_time=240;
    var question8_time=262;
    var question9_time=284;
    var question_status=0;
    var video_length=287; 

    //Mina's change
     //  Capture time changes and display current position
     oVideo.addEventListener('timeupdate', function () {
      currentTime=oVideo.currentTime;
      second_round=Math.floor(currentTime);
      console.log("In event listener");
      console.log(currentTime);
      console.log(second_round);
      console.log(video_length);
      switch(second_round){
        case question1_time:
          if (question_status != 1){
            visibility_switch('question1');
            question_status=1;
            console.log('change to question 1');
          }
          break;
        case question2_time:
          if (question_status != 2){
            visibility_switch('question2');
            question_status=2;
            console.log('change to question 2');
          }
          break;
        case question3_time:
          if (question_status != 3){
            visibility_switch('question3');
            question_status=3;
            console.log('change to question 3');
          }
          break;
        case question4_time:
          if (question_status != 4){
            visibility_switch('question4');
            question_status=4;
            console.log('change to question 4');
          }
        case question5_time:
          if (question_status != 5){
            visibility_switch('question5');
            question_status=5;
            console.log('change to question 5');
          }
          break;
        case question6_time:
          if (question_status != 6){
            visibility_switch('question6');
            question_status=6;
            console.log('change to question 6');
          }
          break;
        case question7_time:
          if (question_status != 7){
            visibility_switch('question7');
            question_status=7;
            console.log('change to question 7');
          }
          break;
        case question8_time:
          if (question_status != 8){
            visibility_switch('question8');
            question_status=8;
            console.log('change to question 8');
          }
          break;
        case question9_time:
          if (question_status != 9){
            visibility_switch('question9');
            question_status=9;
            console.log('change to question 9');
          }
          break;
        case video_length:
          if (question_status != 10){
            buildData();
            question_status=10;
            console.log('submitting data');
          }
          break;  
      }
     }, false);
    
    // switching between single screen and multi screens
    function getCurrentTime(){
      console.log(oVideo.currentTime);
    }

    function clearContent(){
        var num = 6;
        while(num>=0){
            document.getElementsByClassName('user')[num].innerHTML = "";
            document.getElementsByClassName('text')[num].innerHTML = "";
            num-=1;
            console.log(num);
        }
    }


    var display = "1"; //Mina's change
    function toggle4(){
        clearContent();
        location.href = "#q1";
        display = "1"; //Mina's change
    }
    
    //WEARSCRIPT INTEGRATION

    function handleInput(){

    }

    </script>


  </head>

  <body>

  </body>
</html>
